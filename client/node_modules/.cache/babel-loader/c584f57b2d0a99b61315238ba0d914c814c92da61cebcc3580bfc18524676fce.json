{"ast":null,"code":"import React,{createContext,useContext,useState,useEffect}from\"react\";import axios from\"axios\";import toast from\"react-hot-toast\";import{jsx as _jsx}from\"react/jsx-runtime\";const SubscriptionContext=/*#__PURE__*/createContext(undefined);export const useSubscription=()=>{const context=useContext(SubscriptionContext);if(context===undefined){throw new Error(\"useSubscription must be used within a SubscriptionProvider\");}return context;};export const SubscriptionProvider=_ref=>{let{children}=_ref;const[subscription,setSubscription]=useState(null);const[usage,setUsage]=useState(null);const[loading,setLoading]=useState(true);const fetchSubscriptionStatus=async()=>{try{console.log(\"Fetching subscription status...\");const response=await axios.get(\"/api/subscriptions/status\");console.log(\"Subscription response:\",response.data);if(response.data.subscription&&response.data.usage){setSubscription(response.data.subscription);setUsage(response.data.usage);}else{console.warn(\"Missing subscription or usage data in response\");throw new Error(\"Invalid response structure\");}}catch(error){console.error(\"Failed to fetch subscription status:\",error);// Set default values if API fails\nsetSubscription({plan:\"free\",status:\"active\",features:{aiSummaries:5,flashcardGeneration:3,assignmentHelp:2,citations:10}});setUsage({totalNotes:0,totalSummaries:0,totalFlashcards:0,totalAssignments:0,totalCitations:0,lastActive:new Date().toISOString()});}finally{setLoading(false);}};useEffect(()=>{fetchSubscriptionStatus();},[]);const refreshSubscription=async()=>{setLoading(true);await fetchSubscriptionStatus();setLoading(false);};const cancelSubscription=async()=>{try{await axios.post(\"/api/subscriptions/cancel\");await refreshSubscription();toast.success(\"Subscription will be cancelled at the end of the current period\");}catch(error){var _error$response,_error$response$data;const message=((_error$response=error.response)===null||_error$response===void 0?void 0:(_error$response$data=_error$response.data)===null||_error$response$data===void 0?void 0:_error$response$data.error)||\"Failed to cancel subscription\";toast.error(message);throw error;}};const reactivateSubscription=async()=>{try{await axios.post(\"/api/subscriptions/reactivate\");await refreshSubscription();toast.success(\"Subscription reactivated successfully\");}catch(error){var _error$response2,_error$response2$data;const message=((_error$response2=error.response)===null||_error$response2===void 0?void 0:(_error$response2$data=_error$response2.data)===null||_error$response2$data===void 0?void 0:_error$response2$data.error)||\"Failed to reactivate subscription\";toast.error(message);throw error;}};const value={subscription,usage,loading,refreshSubscription,cancelSubscription,reactivateSubscription};return/*#__PURE__*/_jsx(SubscriptionContext.Provider,{value:value,children:children});};","map":{"version":3,"names":["React","createContext","useContext","useState","useEffect","axios","toast","jsx","_jsx","SubscriptionContext","undefined","useSubscription","context","Error","SubscriptionProvider","_ref","children","subscription","setSubscription","usage","setUsage","loading","setLoading","fetchSubscriptionStatus","console","log","response","get","data","warn","error","plan","status","features","aiSummaries","flashcardGeneration","assignmentHelp","citations","totalNotes","totalSummaries","totalFlashcards","totalAssignments","totalCitations","lastActive","Date","toISOString","refreshSubscription","cancelSubscription","post","success","_error$response","_error$response$data","message","reactivateSubscription","_error$response2","_error$response2$data","value","Provider"],"sources":["/Users/muiz/Documents/GitHub/note.ai/client/src/contexts/SubscriptionContext.tsx"],"sourcesContent":["import React, {\n  createContext,\n  useContext,\n  useState,\n  useEffect,\n  ReactNode,\n} from \"react\";\nimport axios from \"axios\";\nimport toast from \"react-hot-toast\";\n\ninterface Subscription {\n  plan: string;\n  status: string;\n  stripeCustomerId?: string;\n  stripeSubscriptionId?: string;\n  currentPeriodEnd?: string;\n  features: {\n    aiSummaries: number;\n    flashcardGeneration: number;\n    assignmentHelp: number;\n    citations: number;\n  };\n}\n\ninterface Usage {\n  totalNotes: number;\n  totalSummaries: number;\n  totalFlashcards: number;\n  totalAssignments: number;\n  totalCitations: number;\n  lastActive: string;\n}\n\ninterface SubscriptionContextType {\n  subscription: Subscription | null;\n  usage: Usage | null;\n  loading: boolean;\n  refreshSubscription: () => Promise<void>;\n  cancelSubscription: () => Promise<void>;\n  reactivateSubscription: () => Promise<void>;\n}\n\nconst SubscriptionContext = createContext<SubscriptionContextType | undefined>(\n  undefined\n);\n\nexport const useSubscription = () => {\n  const context = useContext(SubscriptionContext);\n  if (context === undefined) {\n    throw new Error(\n      \"useSubscription must be used within a SubscriptionProvider\"\n    );\n  }\n  return context;\n};\n\ninterface SubscriptionProviderProps {\n  children: ReactNode;\n}\n\nexport const SubscriptionProvider: React.FC<SubscriptionProviderProps> = ({\n  children,\n}) => {\n  const [subscription, setSubscription] = useState<Subscription | null>(null);\n  const [usage, setUsage] = useState<Usage | null>(null);\n  const [loading, setLoading] = useState(true);\n\n  const fetchSubscriptionStatus = async () => {\n    try {\n      console.log(\"Fetching subscription status...\");\n      const response = await axios.get(\"/api/subscriptions/status\");\n      console.log(\"Subscription response:\", response.data);\n\n      if (response.data.subscription && response.data.usage) {\n        setSubscription(response.data.subscription);\n        setUsage(response.data.usage);\n      } else {\n        console.warn(\"Missing subscription or usage data in response\");\n        throw new Error(\"Invalid response structure\");\n      }\n    } catch (error) {\n      console.error(\"Failed to fetch subscription status:\", error);\n      // Set default values if API fails\n      setSubscription({\n        plan: \"free\",\n        status: \"active\",\n        features: {\n          aiSummaries: 5,\n          flashcardGeneration: 3,\n          assignmentHelp: 2,\n          citations: 10,\n        },\n      });\n      setUsage({\n        totalNotes: 0,\n        totalSummaries: 0,\n        totalFlashcards: 0,\n        totalAssignments: 0,\n        totalCitations: 0,\n        lastActive: new Date().toISOString(),\n      });\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  useEffect(() => {\n    fetchSubscriptionStatus();\n  }, []);\n\n  const refreshSubscription = async () => {\n    setLoading(true);\n    await fetchSubscriptionStatus();\n    setLoading(false);\n  };\n\n  const cancelSubscription = async () => {\n    try {\n      await axios.post(\"/api/subscriptions/cancel\");\n      await refreshSubscription();\n      toast.success(\n        \"Subscription will be cancelled at the end of the current period\"\n      );\n    } catch (error: any) {\n      const message =\n        error.response?.data?.error || \"Failed to cancel subscription\";\n      toast.error(message);\n      throw error;\n    }\n  };\n\n  const reactivateSubscription = async () => {\n    try {\n      await axios.post(\"/api/subscriptions/reactivate\");\n      await refreshSubscription();\n      toast.success(\"Subscription reactivated successfully\");\n    } catch (error: any) {\n      const message =\n        error.response?.data?.error || \"Failed to reactivate subscription\";\n      toast.error(message);\n      throw error;\n    }\n  };\n\n  const value: SubscriptionContextType = {\n    subscription,\n    usage,\n    loading,\n    refreshSubscription,\n    cancelSubscription,\n    reactivateSubscription,\n  };\n\n  return (\n    <SubscriptionContext.Provider value={value}>\n      {children}\n    </SubscriptionContext.Provider>\n  );\n};\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}